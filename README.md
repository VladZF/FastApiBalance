# Балансировщик нагрузки на приложение FastAPI

## Инструкция по использованию

### Настройка python

1) Скачайте интерпритатор python по [ссылке](https://www.python.org/)
2) При установке обязательно поставьте галку напротив **add to PATH** для корректной работы
3) Клонируйте репозиторий
4) Откройте терминал в папке с проектом
5) Введите команду 
```bash 
pip install -r requirements
```

### Настройка конфигурационного файла

После настройки python нужно прописать корректные параметры в файле config.py

В файле находятся 3 параметра

- host - IP-адрес, по которому будут лежать внешнее приложение и копии внутреннего приложения
- main_port - порт, на котором лежит внешнее приложение
- ports - порты, по которым будут располагаться копии внутреннего приложения

### Запуск приложения

Для запуска приложения нужно запустить внешнее приложение и все внутренние.

> [!IMPORTANT]
> Неважно, в каком порядке запускать приложения, важен тот фактор, что количество внутренних приложений должно быть равно длине списка ports в конфиге

Обычно приложение запускается с нескольких терминалов. Для этого в одном из них прописывается команда
```bash
uvicorn external_app:app --host <host> --port <main_port> --reload
```
И в остальных терминах для каждого порта из ports
```bash
uvicorn internal_app:app --host <host> --port <порт>
```

После запуска можно работать с приложением. Для этого в браузере введите url в формате
```http://<host>:<main_port>/docs```. Нажмите на вкладку getInfo, далее на Try it out и execute. Вам будет выдан ответ от одного из внутренних приложений: сообщение и порт, с которого он был получен.
Запросы распределяются между внутренними приложениями по алгоритму Robin Round - каждый новый запрос отправляется на следующий доступный экземпляр в циклическом порядке.
Если экземпляр не отвечает, то он удаляется из пула доступных копий, и обращение по порту, на котором оно было запущено, не производится. В случае, если никакой экземпляр не отвечает, то сервер выдает код 503 с сообщением, что нет ни одного экземпляра.

### Тестовый клиент
Когда приложение полностью запущено, можно запустить файл test_client.py, который пошлет несколько запросов в приложение и в терминал выдаст ответы с сервера.

#### Пример
```
{'message': 'necessary info', 'port': '8081'}
{'message': 'necessary info', 'port': '8082'}
{'message': 'necessary info', 'port': '8083'}
{'message': 'necessary info', 'port': '8081'}
{'message': 'necessary info', 'port': '8082'}
{'message': 'necessary info', 'port': '8083'}
{'message': 'necessary info', 'port': '8081'}
{'message': 'necessary info', 'port': '8082'}
{'message': 'necessary info', 'port': '8083'}
{'message': 'necessary info', 'port': '8081'}
```